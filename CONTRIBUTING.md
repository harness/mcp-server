# Contributing to Harness MCP Server (Rust)\n\nWe welcome contributions to the Harness MCP Server! This document provides guidelines for contributing to the Rust implementation.\n\n## ü¶Ä About the Rust Implementation\n\nThis is the Rust version of the Harness MCP Server, migrated from Go for improved performance, memory safety, and modern async capabilities. We maintain 100% API compatibility with the original Go version while leveraging Rust's strengths.\n\n## üöÄ Getting Started\n\n### Prerequisites\n\n- **Rust 1.75 or later** (install via [rustup](https://rustup.rs/))\n- **Git** for version control\n- **Docker** (optional, for containerized testing)\n- A **Harness account** with API access for testing\n\n### Development Setup\n\n1. **Fork and clone the repository**:\n   ```bash\n   git clone https://github.com/your-username/harness-mcp.git\n   cd harness-mcp\n   ```\n\n2. **Install Rust toolchain components**:\n   ```bash\n   rustup component add rustfmt clippy\n   ```\n\n3. **Build the project**:\n   ```bash\n   cargo build\n   ```\n\n4. **Run tests to verify setup**:\n   ```bash\n   cargo test\n   ```\n\n5. **Set up environment variables for testing**:\n   ```bash\n   export HARNESS_PLATFORM_API_KEY=your_api_key\n   export HARNESS_PLATFORM_ORGANIZATION_ID=your_org_id\n   export HARNESS_PLATFORM_PROJECT_ID=your_project_id\n   ```\n\n## üìù Development Guidelines\n\n### Code Style\n\nWe follow standard Rust conventions:\n\n- **Formatting**: Use `cargo fmt` to format code\n- **Linting**: Use `cargo clippy` to catch common issues\n- **Naming**: Follow Rust naming conventions (snake_case for functions/variables, PascalCase for types)\n- **Documentation**: Use `///` for public API documentation\n- **Error Handling**: Use `Result<T, E>` types consistently\n\n### Code Quality Standards\n\n1. **Safety**: Avoid `unsafe` code unless absolutely necessary\n2. **Performance**: Prefer zero-copy operations and async/await patterns\n3. **Testing**: Write comprehensive tests for new functionality\n4. **Documentation**: Document public APIs and complex logic\n5. **Error Handling**: Provide meaningful error messages with context\n\n### Project Structure\n\n```\nsrc/\n‚îú‚îÄ‚îÄ main.rs              # CLI entry point\n‚îú‚îÄ‚îÄ lib.rs               # Library root\n‚îú‚îÄ‚îÄ config/              # Configuration management\n‚îú‚îÄ‚îÄ harness/             # Harness API integration\n‚îÇ   ‚îú‚îÄ‚îÄ auth/           # Authentication\n‚îÇ   ‚îú‚îÄ‚îÄ client/         # HTTP client\n‚îÇ   ‚îî‚îÄ‚îÄ tools/          # Tool implementations\n‚îú‚îÄ‚îÄ modules/             # Module system\n‚îú‚îÄ‚îÄ toolsets/            # Toolset management\n‚îú‚îÄ‚îÄ types/               # Type definitions\n‚îÇ   ‚îú‚îÄ‚îÄ dto.rs          # Data transfer objects\n‚îÇ   ‚îî‚îÄ‚îÄ traits.rs       # Trait definitions\n‚îî‚îÄ‚îÄ utils/               # Utility functions\n\ntests/\n‚îú‚îÄ‚îÄ unit/                # Unit tests\n‚îú‚îÄ‚îÄ e2e/                 # End-to-end tests\n‚îî‚îÄ‚îÄ lib.rs               # Test utilities\n```\n\n## üîß Development Workflow\n\n### Making Changes\n\n1. **Create a feature branch**:\n   ```bash\n   git checkout -b feature/your-feature-name\n   ```\n\n2. **Make your changes** following the guidelines above\n\n3. **Run the development checks**:\n   ```bash\n   # Format code\n   cargo fmt\n   \n   # Run linter\n   cargo clippy -- -D warnings\n   \n   # Run tests\n   cargo test\n   \n   # Check documentation\n   cargo doc --no-deps\n   ```\n\n4. **Test your changes**:\n   ```bash\n   # Run unit tests\n   cargo test --lib\n   \n   # Run integration tests\n   cargo test --test '*'\n   \n   # Run E2E tests (requires environment setup)\n   cargo test --test e2e\n   ```\n\n5. **Commit your changes**:\n   ```bash\n   git add .\n   git commit -m \"feat: add new feature description\"\n   ```\n\n### Commit Message Format\n\nWe use [Conventional Commits](https://www.conventionalcommits.org/):\n\n- `feat:` for new features\n- `fix:` for bug fixes\n- `docs:` for documentation changes\n- `style:` for formatting changes\n- `refactor:` for code refactoring\n- `test:` for adding tests\n- `chore:` for maintenance tasks\n\nExamples:\n```\nfeat: add CCM cost analysis tool\nfix: handle timeout errors in pipeline execution\ndocs: update API documentation for connectors\ntest: add unit tests for authentication module\n```\n\n## üß™ Testing\n\n### Test Types\n\n1. **Unit Tests**: Test individual functions and modules\n   ```bash\n   cargo test --lib\n   ```\n\n2. **Integration Tests**: Test component interactions\n   ```bash\n   cargo test --test integration\n   ```\n\n3. **End-to-End Tests**: Test full workflows with real APIs\n   ```bash\n   # Requires environment variables\n   cargo test --test e2e\n   ```\n\n### Writing Tests\n\n- Place unit tests in the same file as the code being tested\n- Use the `tests/` directory for integration and E2E tests\n- Mock external dependencies in unit tests\n- Use real APIs sparingly in E2E tests\n\nExample unit test:\n```rust\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_parse_api_key() {\n        let api_key = \"pat.account.project.key\";\n        let result = parse_api_key(api_key).unwrap();\n        assert_eq!(result.account_id, \"account\");\n    }\n\n    #[tokio::test]\n    async fn test_async_function() {\n        let result = async_function().await;\n        assert!(result.is_ok());\n    }\n}\n```\n\n### Test Coverage\n\nWe aim for high test coverage:\n\n```bash\n# Install coverage tool\ncargo install cargo-tarpaulin\n\n# Generate coverage report\ncargo tarpaulin --out Html --output-dir coverage\n```\n\n## üîç Adding New Tools\n\nTo add a new MCP tool:\n\n1. **Define the tool in the appropriate module**:\n   ```rust\n   // src/harness/tools/your_service.rs\n   use crate::types::{HarnessError, Tool};\n   use serde_json::Value;\n\n   pub async fn your_tool_handler(\n       params: Value,\n       client: &HarnessClient,\n   ) -> Result<Value, HarnessError> {\n       // Implementation\n   }\n\n   pub fn create_your_tool() -> Tool {\n       Tool::new(\n           \"your_tool_name\",\n           \"Description of your tool\",\n           serde_json::json!({\n               \"type\": \"object\",\n               \"properties\": {\n                   \"param1\": {\n                       \"type\": \"string\",\n                       \"description\": \"Parameter description\"\n                   }\n               },\n               \"required\": [\"param1\"]\n           }),\n           your_tool_handler,\n       )\n   }\n   ```\n\n2. **Register the tool in the toolset**:\n   ```rust\n   // src/toolsets/your_toolset.rs\n   pub fn register_your_toolset(group: &mut ToolsetGroup) -> Result<(), HarnessError> {\n       let toolset = Toolset::new(\"your_toolset\")\n           .add_tool(create_your_tool());\n       \n       group.add_toolset(toolset)\n   }\n   ```\n\n3. **Add tests for your tool**:\n   ```rust\n   #[cfg(test)]\n   mod tests {\n       use super::*;\n       use crate::test_utils::*;\n\n       #[tokio::test]\n       async fn test_your_tool() {\n           let client = create_test_client();\n           let params = serde_json::json!({\"param1\": \"test_value\"});\n           \n           let result = your_tool_handler(params, &client).await;\n           assert!(result.is_ok());\n       }\n   }\n   ```\n\n## üêõ Debugging\n\n### Logging\n\nUse the `tracing` crate for logging:\n\n```rust\nuse tracing::{debug, info, warn, error};\n\ninfo!(\"Processing request for tool: {}\", tool_name);\ndebug!(\"Request parameters: {:?}\", params);\nwarn!(\"Deprecated parameter used: {}\", param_name);\nerror!(\"Failed to process request: {}\", error);\n```\n\nSet log levels:\n```bash\nRUST_LOG=debug cargo run\nRUST_LOG=trace cargo test\n```\n\n### MCP Inspector\n\nUse the MCP Inspector for debugging MCP protocol issues:\n\n```bash\nnpx @modelcontextprotocol/inspector ./target/debug/harness-mcp-server stdio\n```\n\n## üì¶ Dependencies\n\n### Adding Dependencies\n\nWhen adding new dependencies:\n\n1. **Prefer well-maintained crates** with good documentation\n2. **Check license compatibility** (prefer MIT/Apache-2.0)\n3. **Consider bundle size impact** for the final binary\n4. **Add to appropriate section** in `Cargo.toml`:\n   ```toml\n   [dependencies]\n   # Runtime dependencies\n   tokio = { version = \"1.0\", features = [\"full\"] }\n   \n   [dev-dependencies]\n   # Test-only dependencies\n   mockito = \"1.0\"\n   ```\n\n### Dependency Guidelines\n\n- **Async Runtime**: Use Tokio for async operations\n- **HTTP Client**: Use reqwest for HTTP requests\n- **JSON**: Use serde_json for JSON handling\n- **Error Handling**: Use thiserror for error types\n- **Logging**: Use tracing for structured logging\n- **Testing**: Use tokio-test for async tests\n\n## üöÄ Performance Considerations\n\n### Best Practices\n\n1. **Async/Await**: Use async functions for I/O operations\n2. **Connection Pooling**: Reuse HTTP connections\n3. **Memory Management**: Avoid unnecessary allocations\n4. **Error Handling**: Use `?` operator for early returns\n5. **Serialization**: Use zero-copy deserialization when possible\n\n### Profiling\n\n```bash\n# Install profiling tools\ncargo install cargo-flamegraph\n\n# Generate flame graph\ncargo flamegraph --bin harness-mcp-server\n```\n\n## üìã Pull Request Process\n\n1. **Ensure your PR**:\n   - Follows the coding standards\n   - Includes appropriate tests\n   - Updates documentation if needed\n   - Passes all CI checks\n\n2. **PR Description should include**:\n   - Clear description of changes\n   - Motivation for the changes\n   - Testing performed\n   - Breaking changes (if any)\n\n3. **Review Process**:\n   - At least one maintainer review required\n   - All CI checks must pass\n   - Address review feedback promptly\n\n## üîí Security\n\n### Security Guidelines\n\n1. **Input Validation**: Validate all external inputs\n2. **Secret Management**: Never commit secrets or API keys\n3. **Dependencies**: Keep dependencies updated\n4. **Error Messages**: Don't leak sensitive information in errors\n\n### Reporting Security Issues\n\nFor security vulnerabilities, please email security@harness.io instead of creating a public issue.\n\n## üìö Resources\n\n- [Rust Book](https://doc.rust-lang.org/book/)\n- [Rust API Guidelines](https://rust-lang.github.io/api-guidelines/)\n- [Tokio Documentation](https://tokio.rs/)\n- [MCP Specification](https://modelcontextprotocol.io/)\n- [Harness API Documentation](https://docs.harness.io/)\n\n## ü§ù Community\n\n- **Discord**: Join our [Discord server](https://discord.gg/harness)\n- **Forum**: [Community Forum](https://community.harness.io)\n- **Twitter**: [@HarnessIO](https://twitter.com/HarnessIO)\n\n## üìÑ License\n\nBy contributing, you agree that your contributions will be licensed under the Apache License 2.0.\n\nThank you for contributing to the Harness MCP Server! üéâ\n